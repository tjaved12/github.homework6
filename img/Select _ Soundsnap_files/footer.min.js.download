var $nid,timer,path="";function fav_loader(e,t){var a=$j("#throbber-"+e);"show"===t&&(a.show(),$j("#fav-container-"+e).removeClass("active"),$j("#fav-container-"+e+">.favorite_message").empty()),"hide"===t&&a.hide(),"over-show"===t&&(a.show(),$j(".favorites_groups").css({opacity:"0.3"})),"over-hide"===t&&(a.hide(),$j(".favorites_groups").css({opacity:"1"}))}function confirm_dialog(e){$j("body").append("<div id='TB_overlay'></div><div id='TB_window' class='TB-dialog'></div>"),$j("#TB_window").append("<div id='TB_title'><div id='TB_ajaxWindowTitle'><h2 class='title'>Favorites</h2></div><div id='TB_closeAjaxWindow'><a href='#' id='TB_closeWindowButton' title='Close'>close</a></div></div>"),$j("#TB_window").append("<div id='TB_ajaxContent'>"+e.message+"</div>"),$j("#TB_ajaxContent").append("<div><a href='"+e.url+"' class='form-submit "+e.class+"'>"+e.button+"</a></div>");var t=($j(window).width()-$j("#TB_window").width())/2/$j(window).width(),a=($j(window).height()-2*$j("#TB_window").height())/2/$j(window).height();$j("#TB_window").css({left:100*t+"%",top:100*a+"%"}),$j("#TB_window").show()}$j(document).on("submit",".favorites_groups form",function(e){e.preventDefault();var t=$j(this).parents(".fav-container").attr("data-nid");$j("#fav-container-"+t+" .fav-group-add-button").trigger("click")}),$j(document).on("click",".fav-group-add-button",function(){var e,t=$j(this).parents(".fav-container").attr("data-nid"),a=$j("#title-fav-group-"+t).val(),o="title="+a;return 0<a.length&&(fav_loader(t,"show"),(e=new XMLHttpRequest).open("GET",path+"/favorites_group/add/"+t+"?ajax=true&"+o,!0),e.onreadystatechange=function(){200===e.status&&($j("#fav-container-"+t).html(e.responseText),fav_loader(t,"hide"))},e.send(),$j(".si_favorite").addClass("update_needed")),!1}),$j(document).on("click",".favorites_groups > li > a.fav-add",function(){var e,t=$j(this).parents(".fav-container").attr("data-nid"),a=$j(this).attr("data-gid");return void 0===a||(fav_loader(t,"show"),(e=new XMLHttpRequest).open("GET",path+"/favorite_nodes/add/"+t+"/"+a+"?ajax=true",!0),e.onreadystatechange=function(){200===e.status&&($j("#fav-container-"+t).html(e.responseText),fav_loader(t,"hide"))},e.send()),!1}),$j(document).on("click",".si_favorite",function(e){$nid=$j(this).parent(".fav-container").attr("data-nid");var t,a=$j(this);a.hasClass("si_public")||(e.preventDefault(),a.hasClass("si_active")?confirm_dialog({url:$j(this).attr("href"),class:"confirm-delete",message:"Are you sure you want to remove<br> the sound from your favorites?",button:"Remove"}):($j("#fav-container-"+$nid).addClass("active"),a.hasClass("update_needed")&&(fav_loader($nid,"over-show"),(t=new XMLHttpRequest).open("GET",path+"/favorites_group/check_update/"+$nid+"?ajax=true",!0),t.onreadystatechange=function(){200==t.status&&""!=t.responseText&&($j("#fav-container-"+$nid+" .favorites_groups").html(t.responseText),fav_loader($nid,"over-hide"))},t.send(),a.removeClass("update_needed"))))}),$j(function(){$j(document).on("click",".confirm-delete",function(e){e.preventDefault(),fav_loader($nid,"show");var t=new XMLHttpRequest;t.open("GET",path+"/favorite_nodes/delete/"+$nid+"?ajax=true",!0),t.onreadystatechange=function(){200===t.status&&(-1<window.location.href.indexOf("favorites")&&$j("#node-"+$nid).stop().animate({opacity:"0"},800).slideUp(),$j("#fav-container-"+$nid).html(t.responseText),fav_loader($nid,"hide"))},t.send()})}),$j(document).on("click",".js-share-privacy-status a.fav-privacy-status-button",function(e){e.preventDefault(),$url=$j(this).attr("href"),$j(".js-share-privacy-status").addClass("throbber_loader_black");var t=new XMLHttpRequest;return t.open("GET",path+$url+"?ajax=true",!0),t.onreadystatechange=function(){200===t.status&&($j(".js-share-privacy-status").html(t.responseText).removeClass("throbber_loader_black"),$j(".js-share-content").toggleClass("private shared"))},t.send(),!1}),$j(document).on("mouseenter",".fav-container",function(){clearTimeout(timer)}),$j(document).on("mouseleave",".fav-container",function(){clearTimeout(timer),$div=$j(this),timer=setTimeout(function(){$div.removeClass("active")},2e3)}),$j(document).on("click","body",function(e){!$j(e.target).closest(".fav-container").length&&$j(".fav-container").hasClass("active")&&$j(".fav-container").removeClass("active"),$j(e.target).closest(".favorites_toolbar").length||0!=$j(".fav-group-openadd-button:visible").length||($j(".fav-group-add-form").hide(),$j(".fav-group-openadd-button").show()),$j(e.target).closest(".favorites_toolbar").length||0!=$j(".fav-group-title:visible").length||($j(".fav-group-edit-form").hide(),$j(".fav-group-title").show())}),$j(document).on("click",".fav-group-delete-button",function(e){e.preventDefault(),confirm_dialog({url:$j(this).attr("href"),class:"",message:"Are you sure you want to delete this list?",button:"Delete"})}),$j(document).on("click",".fav-group-privacy-button",function(e){e.preventDefault(),confirm_dialog({url:$j(this).attr("href"),class:"",message:"Are you sure you want to change<br>the privacy settings of this list?",button:"Change"})}),$j(document).on("click","#TB_closeWindowButton",function(e){e.preventDefault(),$j("#TB_overlay").remove(),$j("#TB_window").remove()}),$j(document).on("click",".TB-dialog #TB_ajaxContent .form-submit",function(){$j("#TB_overlay").remove(),$j("#TB_window").remove()}),jQuery.fn.extend({initModalOptions:function(){jQuery.modal.defaults.fadeDuration=50,jQuery(window).on(jQuery.modal.BEFORE_OPEN,function(e,t){jQuery.modal.isActive()}),jQuery(".modal-link").on("click",function(e){return jQuery(this).modal({fadeDuration:50}),!1})}}),jQuery(function(){jQuery.fn.initModalOptions()}),jQuery(window).on(jQuery.modal.OPEN,function(e,t){labelAnimation.initlabelAnimation(),initSoundsnap.initCollapse(),labelAnimation.initRequiredFields(),loginTemplate.initLoginTemplate(),checkUser.initCheckUser(),jQuery.fn.initModalOptions();var a=window.location.href;jQuery(".modal form#user_login_block, .modal form#user_register").submit(function(e){e.preventDefault();var t=jQuery(this);t.prepend("<div class='spin-loader'></div>");var o=t.serializeArray(),n=JSON.stringify(o);return jQuery.ajax({type:"POST",data:{edit:n},url:"/login_callback",dataType:"html",success:function(e){var t=jQuery.parseJSON(e);t.message?(jQuery(".modal-message").html(t.message),jQuery(".spin-loader").remove()):t.destination?window.location=t.destination:t.action?window.location=t.action:window.location=a},error:function(){}}),!1})});
